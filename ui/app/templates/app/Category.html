{% extends "app/base.html" %}
{% load static %}
{% block title %} Home {% endblock title %}
{% block extracss %}
<style>
  body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 20px;
  }
  .card-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
      justify-content: center;
  }
  .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      width: 300px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      overflow: hidden;
      text-align: center;
      transition: transform 0.2s;
  }
  .card:hover {
      transform: scale(1.05);
  }
  .card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
  }
  .card h3 {
      margin: 16px 0;
  }
  .card p {
      color: #555;
      padding: 0 16px;
  }
  .card a {
      display: inline-block;
      margin: 16px 0;
      color: #007bff;
      text-decoration: none;
  }
  .card a:hover {
      text-decoration: underline;
  }
  @media (max-width: 768px) {
      .card {
          width: 45%;
      }
  }
  @media (max-width: 480px) {
      .card {
          width: 90%;
      }
  }
</style>
{% endblock extracss %}


{% block information %}
  
    <div class="card-container" id="recommendations"></div>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {

            const category = "{{ category|escapejs }}"; // Example product ID, replace with dynamic value if needed
            console.log("Document loaded, category:", category); // Debugging statement
            

            const token = localStorage.getItem('access_token');
            if (!token) {
                alert('No token found, please log in');
                window.location.href = '/login';
                return;
            }

            try {
                const response = await fetch('http://127.0.0.1:8000/users/me', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user details');
                }

                const userData = await response.json();
                console.log('User details fetched successfully', userData);

                // Fetch recommendations
                fetchCourses(token,category);

            } catch (error) {
                console.error('Error fetching user details:', error);
                document.getElementById('error-message').textContent = 'Failed to load user details. Please try again later.';
            }
        });

        async function fetchCourses(token,category) {
            console.log("Fetching courses for category:", category); 
            try {
                const response = await fetch(`http://127.0.0.1:8000/users/courseCategory/${category}`, {

                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch recommendations');
                }

                const data = await response.json();
                console.log('courses fetched successfully', data);
                displayCourses(data.course_list);

            } catch (error) {
                console.error('Error fetching recommendations:', error);
                document.getElementById('error-message').textContent = 'Failed to load recommendations. Please try again later.';
            }
        }

        function displayCourses(courses) {
            const recommendationsDiv = document.getElementById('recommendations');
            courses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'card';
                courseCard.innerHTML = `
                    <img src="{% static 'app/images/product/C1.jpg' %}" alt="Course Image">
                    <h3><a href="/CoursePage/${course.id}/">${course.title}</a></h3>
                    <p>Category: ${course.category}</p>
                    <a href="${course.url}" target="_blank">Course Link</a>
                `;
                recommendationsDiv.appendChild(courseCard);
            });
        }
    </script>

{% endblock information %} 
